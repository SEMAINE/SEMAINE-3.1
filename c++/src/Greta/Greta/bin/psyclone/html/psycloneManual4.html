<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head><title>Psyclone:Manual:Part 4 of 4</title><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">  <link rel="stylesheet" href="style.css">  <title>Psyclone:Use Cases</title></head><body><div align="center">   <table bgcolor="#ffffff" border="0" cellpadding="0" cellspacing="0" height="36" width="688">    <tbody>      <tr align="right" valign="bottom">         <td class="navLink" align="left" height="18" width="129">&nbsp;</td>        <td class="navLink" align="left" height="18" width="130">&nbsp;</td>        <td class="navLink" align="left" height="30" width="217"> <div align="right"></div></td>        <td class="navLink" width="109"><a href="psycloneManual.html">manual_:</a>:</td>        <td class="navLink" width="103"><a href="index.html">index_:</a>:</td>      </tr>      <tr align="right" valign="middle">         <td colspan="5" align="left" height="18"><br> <img src="images/simple-circle-line-1.gif"></td>      </tr>    </tbody>  </table>  <table border="0" cellpadding="0" cellspacing="0" height="112" width="688">    <tbody>      <tr>         <td align="left" background="" height="67" valign="middle" width="300"><img src="images/psycloneTutorialLogo.gif">         </td>        <td align="left" background="" valign="middle" width="388"><div align="center" class="boxTitle">            <p><font size="3"><b><a href="psycloneTutorial.html" target="_blank">USE               CASES</a></b><br>              <font size="2">PART 4 of 4</font></font></p>            </div>                  </td>      </tr>      <tr>         <td height="45" colspan="2" align="left" valign="middle" background=""><img src="images/simple-circle-line-1.gif"></td>      </tr>    </tbody>  </table></div><table width="688" height="32" border="0" align="center" cellpadding="0" cellspacing="0">  <tbody>    <tr>       <td class="tutorialSectionHeading" align="left" height="32" valign="top" width="147"><b><a href="index.html" class="tutorialSubsectionHeading">Back         to Index</a></b></td>      <td align="left" valign="CENTER" width="95"></td>      <td class="smallSizeNonConspicuous" align="right" valign="middle" width="446">An         index to the main sections below is stored in index.html <br>        that should be part of the distribution that includes this file</td>    </tr>  </tbody></table><p align="center"><img src="images/simple-circle-line-1.gif"></p><p align="center">&nbsp;</p><table width="688" border=1 align="center" cellpadding=2 cellspacing=0 bordercolor="#666666" bgcolor="#666666" >  <tr>     <td width="679" height="7436" valign=top>       <p>&nbsp;</p>      <table align="center" bgcolor="#ffffff" border="0" cellpadding="2" cellspacing="0" width="670">        <tbody>          <tr background="images/grey-bk.gif" valign="CENTER">             <td class="tutorialSubsectionHeading" bgcolor="#f7f7f7" height="30" width="465"><b><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif"><a name="about"></a>About               Use Cases</font></b></td>            <td align="right" bgcolor="#f7f7f7" width="118"><b><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#b9b9b9"><a href="index.html" class="navLink"><b><font face="Verdana, Arial, Helvetica, sans-serif">Back               to Index</font></b></a></font></font></b></td>            <td align="right" bgcolor="#f7f7f7" width="87"></td>          </tr>          <tr>             <td colspan="3" height="122" valign="top"> <p><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#333333"><font size="-1">You                 are looking at the </font></font></font><span class="keyConcept">Psyclone&trade;                 Use Cases </span><font face="Verdana, Arial, Helvetica, sans-serif"><font size="-1"><font color="#333333">file,                 which technically is part of the Psyclone Tutorial suite. To use                 it you must be familiar with certain concepts and have experience                 with certain things, as listed in the section <a href="psycloneManual2.html#prerequisits" class="navLink">Prerequisits</a>.</font></font></font>               </p>              <p>This set of use case examples is designed to familiarize you                 with the Psyclone feature set and some important concepts through                 explicit examples in the use of Psyclone and the construction                 of systmes using it. You should walk away from this set of tutorials                 with the ability to easily, effectively and comfortably design                 and build mixed-language, highly configurable intelligent distributed                 environments. </p></td>          </tr>        </tbody>      </table>      <p>&nbsp;</p>      <table align="center" bgcolor="#ffffff" border="0" cellpadding="2" cellspacing="0" width="670">        <tbody>          <tr bordercolor="#B9B9B9" background="images/grey-bk.gif" bgcolor="#f7f7f7" valign="CENTER">             <td class="tutorialSubsectionHeading" height="50" width="520"><a name="connecting2programs" id="connecting2programs"></a>Connecting               2 programs via the network <br>              and sending messages between them</td>            <td align="right" width="118"><a href="index.html" class="navLink">Back               to Index</a></td>            <td align="right" width="88">&nbsp;</td>          </tr>          <tr>             <td colspan="3" height="244" valign="top"> <p><span class="tutorialSubsectionHeading"></span></p>              <p><span class="tutorialSubsectionHeading">Option 1: Use Corelibrary<br>                </span> If you really only need to connect 2 pieces of software                 on 2 computers, and you don't expect to expand your system in                 the future, and one or both are written in C++, you should consider                 using <a href="http://sourceforge.net/projects/corelibrary/" class="navLink">CoreLibrary</a>.               </p>              <p><span class="tutorialSubsectionHeading">Option 2: Use Psyclone<br>                </span> This is a scalable and robust method &#8212; you can easliy                 add more computers, and you get message and module debugging (<a href="psycloneManual.html#psy:psyprobe" class="navLink">psyProbe</a>).                 You connect two programs together via Psyclone by wrapping the                 programs in <a href="psycloneManual.html#psy:airplugs" class="navLink">AIRPlugs</a>                 and use these to connect via a <a href="psycloneManual.html#psy:whiteboards" class="navLink">whiteboard</a>                 in Psyclone. To do so you should take the following tutorials                 (before looking at this one): </p>              <ol>                <li> <span class="navLink"><a class="navLink" href="psycloneManual2.html#gettingstarted">How                   to start up Psyclone</a></span></li>                <li><span class="navLink"> Writing external modules in <a href="psycloneManual2.html#writingexternaljavamodules">Java</a>                   / <a href="psycloneManual2.html#writingexternalcppmodules">C++</a></span></li>              </ol>              <blockquote>                 <p class="mediumSizeNonConspicuous">When running a time-dependent                   system across a network you may want to synchronize the clocks                   on the computers, otherwise the various <a href="psycloneManual.html#psy:post" class="navLink">post</a>                   and <a href="psycloneManual.html#psy:receive" class="navLink">receive</a>                   timestamps on <a href="http://www.mindmakers.org/openair/" class="navLink">OpenAIR                   messages</a> will not be comparable between computers. Synchronization                   can be done using the Network Time Protocol <a href="http://www.ntp.org/" class="navLink">NTP                   daemon</a>; it is compatible with virtually all platforms. </p>              </blockquote>              <p>The system we are about to describe will aptly demonstrate how                 two programs written in two different languages can communicate                 across a network. (The files for this examples should have been                 included with this Psyclone distribution.) The system does the                 following: </p>              <blockquote>                 <p> One program will assign a task<br>                  A second program will complete the task</p>              </blockquote>              <p>TaskAssigner will connect to Psyclone, trigger itself once (this                 is allowed as indicated by the attribute <span class="codeXML">allowselftriggering="yes"</span>),                 and post a task assignment message with the parameterized blurb                 Do this. Worker will be triggered on task assignment, do the task,                 and post a task completion message with the parameterized blurb                 I have finished. </p>              <p> TaskAssigner will be triggered on this task completion, and                 proceed to assign another task, and will continue in this fashion.                 TaskAssigner can be shutdown to discontinue task assignment and                 restarted to continue task assignment.</p>              <p>The example makes use of the <a href="psycloneManual3.html#usingmoduleparameters" class="navLink">parameter                 mechanism</a> in Psyclone. The task assignment program, TaskAssigner,                 is written in Java. The module specification, which we will put                 into a psySpec, looks like this: </p>              <blockquote>                 <p> &lt;module name="<span class="dataValue">TaskAssigner</span>"                   allowselftriggering="<span class="dataValue">yes</span>"&gt;<br>                  &nbsp;&nbsp;&lt;executable /&gt;<br>                  &nbsp;&nbsp;&lt;parameter name="<span class="dataValue">blurb</span>"                   type="<span class="dataValue">String</span>" value="<span class="dataValue">Do                   this.</span>"/&gt;<br>                  &nbsp;&nbsp;&lt;spec&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&lt;context name="<span class="dataValue">Psyclone.System.Ready</span>"&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;phase id="<span class="dataValue">Assign                   task</span>"&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;triggers                   from="<span class="dataValue">WB1</span>"&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;trigger                   after="<span class="dataValue">500</span>" type="<span class="dataValue">TaskAssigner.Ready</span>"/&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;trigger                   after="<span class="dataValue">500</span>" type="<span class="dataValue">Output.Task.Complete</span>"/&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/triggers&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;posts&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;post                   to="<span class="dataValue">WB1</span>" type="<span class="dataValue">Output.Task.Assign</span>"                   /&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/posts&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/phase&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&lt;/context&gt;<br>                  &nbsp;&nbsp;&lt;/spec&gt;<br>                  &lt;/module&gt;</p>              </blockquote>              <blockquote>                 <p><span class="mediumSizeNonConspicuous">(Remember, you do not                   need the &lt;context&gt; and &lt;phase&gt; tags if you are building                   simple systems such as this example; they are only included                   here for clarity.)</span> </p>              </blockquote>              <p>TaskAssigner.java, which will use AIR to connect to Psyclone,                 will be constructed like this:</p>              <blockquote>                 <p class="codeJava"> public class TaskAssigner {<br>                  &nbsp;&nbsp;private JavaAIRPlug plug; // the connection to Psyclone<br>                  &nbsp;&nbsp;private Message triggerMessage; // reusable incoming                   message<br>                  &nbsp;&nbsp;private Message msg; // reusable ougoing message<br>                  /**<br>                  * This module waits for messages and responds.<br>                  * It could run some code after each message, depending on the                   phase.<br>                  * This has been simulated with the System.out.println() calls.<br>                  */<br>                  &nbsp;&nbsp;public TaskAssigner(String plugName, String host,                   int port) {<br>                  &nbsp;&nbsp;&nbsp;&nbsp;System.out.println(plugName +" "+ host                   +" "+ port);<br>                  &nbsp;&nbsp;&nbsp;&nbsp;plug = new JavaAIRPlug(plugName, host,                   port);<br>                  &nbsp;&nbsp;&nbsp;&nbsp;if (!plug.init()) {<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Couldn't                   connect to Psyclone...");<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;} else {<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println("Connected                   to Psyclone");<br>                  &nbsp;&nbsp;&nbsp;&nbsp;}<br>                  &nbsp;&nbsp;&nbsp;&nbsp;String blurb = plug.getParameterString("blurb");<br>                  &nbsp;&nbsp;&nbsp;&nbsp;plug.postMessage("WB1", "TaskAssigner.Ready",                   "");<br>                  &nbsp;&nbsp;&nbsp;&nbsp;while (true) {<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ((triggerMessage = plug.waitForNewMessage(50))                   != null) {<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;System.out.println(triggerMessage.getContent());<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// Task assignment processing                   should occur here<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;msg = new Message(, ,,                   blurb, );<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plug.addOutputMessage(msg);<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plug.sendOutputMessages();<br>                  &nbsp;&nbsp;&nbsp;&nbsp;}<br>                  &nbsp;&nbsp;&nbsp;&nbsp;}<br>                  &nbsp;&nbsp;}<br>                  }</p>              </blockquote>              <p> The task completion program, Worker, will be written in C++.                 The module specification will look like this:</p>              <blockquote>                 <p class="codeXML"> &lt;module name="<span class="dataValue">Worker</span>"                   allowselftriggering="<span class="dataValue">no</span>"&gt;<br>                  &nbsp;&nbsp;&lt;executable /&gt;<br>                  &nbsp;&nbsp;&lt;parameter name="<span class="dataValue">blurb</span>"                   type="<span class="dataValue">String</span>" value="<span class="dataValue">I                   have finished.</span>"/&gt;<br>                  &nbsp;&nbsp;&lt;spec&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&lt;context name="<span class="dataValue">Psyclone.System.Ready</span>"&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;phase id="<span class="dataValue">Complete                   task</span>"&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;triggers from="<span class="dataValue">WB1</span>"&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;trigger                   after="<span class="dataValue">500</span>" type="<span class="dataValue">Output.Task.Assign</span>"/&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/triggers&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;posts&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;post to="<span class="dataValue">WB1</span>"                   type="<span class="dataValue">Output.Task.Complete</span>" /&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/posts&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/phase&gt;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&lt;/context&gt;<br>                  &nbsp;&nbsp;&lt;/spec&gt;<br>                  &lt;/module&gt;</p>              </blockquote>              <p> The code for this module is nearly identical to the TaskAssigner:</p>              <blockquote>                 <p> <span class="codeCPP">Message* triggerMessage;<br>                  JTime lastTime;<br>                  CppAIRPlug* plug = new CppAIRPlug(name, host, port);<br>                  if (!plug-&gt;init()) {<br>                  &nbsp;&nbsp;printf("Couldn't connect to Psyclone..."); fflush(stdout);<br>                  return 0;<br>                  } else {<br>                  &nbsp;&nbsp;printf("Connected to Psyclone");<br>                  }<br>                  JString blurb = plug-&gt;getParameterString("blurb");<br>                  while (true) {<br>                  &nbsp;&nbsp;if ((triggerMessage = tv-&gt;waitForNewMessage(50))                   != NULL) {<br>                  &nbsp;&nbsp;&nbsp;&nbsp;printf("%s\n", (char *) triggerMessage-&gt;getContent());<br>                  &nbsp;&nbsp;&nbsp;&nbsp;// Worker's work should be performed                   here<br>                  &nbsp;&nbsp;&nbsp;&nbsp;Message* msg = new Message("", "", "",                   blurb, "");<br>                  &nbsp;&nbsp;&nbsp;&nbsp;plug-&gt;addOutputMessage(msg);<br>                  &nbsp;&nbsp;&nbsp;&nbsp;plug-&gt;sendOutputMessages();<br>                  &nbsp;&nbsp;} else {<br>                  &nbsp;&nbsp;&nbsp;&nbsp;if (!tv-&gt;isServerAvailable())<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("x");<br>                  &nbsp;&nbsp;&nbsp;&nbsp;else<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf(".");<br>                  &nbsp;&nbsp;&nbsp;&nbsp;fflush(stdout);<br>                  &nbsp;&nbsp;&nbsp;&nbsp;count++;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;if (count == 10) {<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("\r \r"); <br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fflush(stdout);<br>                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;count = 0;<br>                  &nbsp;&nbsp;&nbsp;&nbsp;}<br>                  &nbsp;&nbsp;}<br>                  }<br>                  } </span></p>              </blockquote>              <p>In your favorite text editor, include the module specifications                 above into a psySpec and save the file as &lsquo;twoWorkers.xml.                 Remember to include a whiteboard spec, and in your spec include                 one whiteboard, and name the whiteboard WB1, like this:</p>              <blockquote>                 <p class="codeXML"> &lt;whiteboard name="<span class="dataValue">WB1</span>"                   maxcount="<span class="dataValue">10000</span>"&gt;<br>                  &nbsp;&nbsp;&lt;description&gt;<span class="dataValue">This                   is Whiteboard 1</span>&lt;/description&gt;<br>                  &lt;/whiteboard&gt;</p>              </blockquote>              <p> At the command line, run Psyclone with the name of the spec                 file above using the command: </p>              <blockquote>                 <p class="commandlineText">&gt;./psyclone spec=twoWorkers.xml</p>              </blockquote>              <p> For this exercise, Worker should run on a machine other than                 the one that Psyclone is running on. After the Worker has been                 compiled and linked in the C++ development environment of your                 choice, simply move the Worker executable to a different machine,                 and run the executable as:</p>              <blockquote>                 <p class="commandlineText"> &gt;./worker psyclone=[machine]:10000                   name=Worker</p>              </blockquote>              <p> where [machine] is the machine name or IP address of the machine                 that Psyclone is running on. Worker will connect and just wait                 until it is assigned a task by TaskAssigner. </p>              <p> For this exercise, TaskAssigner should run on a machine other                 than the one that Psyclone and Worker are running on. If the TaskAssigner                 has been successfully compiled in a Java environment, move the                 class file to a different machine, and run the TaskAssigner as:</p>              <blockquote>                 <p class="commandlineText"> &gt;java -cp .;JavaOpenAIR.jar TaskAssigner                   psyclone=[machine]:10000 name=TaskAssigner</p>              </blockquote>              <p> if you are operating in Windows, and</p>              <blockquote>                 <p class="commandlineText"> &gt;./java -cp ./:JavaOpenAIR.jar                   TaskAssigner psyclone=[machine]:10000 name=TaskAssigner</p>              </blockquote>              <p> if you are operating in a Unix-based OS. </p>              <blockquote>                 <p class="mediumSizeNonConspicuous">When running a time-dependent                   system across a network you may want to synchronize the clocks                   on the computers, otherwise the various <a href="psycloneManual.html#psy:post" class="navLink">post</a>                   and <a href="psycloneManual.html#psy:receive" class="navLink">receive</a>                   timestamps on <a href="http://www.mindmakers.org/openair/" class="navLink">OpenAIR                   messages</a> will not be comparable between computers. Synchronization                   can be done using the Network Time Protocol <a href="http://www.ntp.org/" class="navLink">NTP                   daemon</a>; it is compatible with virtually all platforms. </p>              </blockquote></td>          </tr>        </tbody>      </table>      <p>&nbsp;</p>      <p>&nbsp;</p>      <table width="669" border=0 align="center" cellpadding=2 cellspacing=0 bgcolor="#FFFFFF" >        <tr valign=CENTER bgcolor="#F7F7F7" background="images/grey-bk.gif" bordercolor="#B9B9B9">           <td width="474" height="50" class="tutorialSubsectionHeading"><a name="connectingmanyprograms" id="connectingmanyprograms"></a>Connecting             many programs via the network <br>            and sending messages between them</td>          <td width="115" align=RIGHT><b><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#B9B9B9"><a href="index.html" class="navLink"><b><font face="Verdana, Arial, Helvetica, sans-serif">Back             to Index</font></b></a></font></font></b></td>          <td align=RIGHT width="80">&nbsp;</td>        </tr>        <tr>           <td valign=TOP colspan="3" height="244"> <p>If you need to connect three               or more programs together Psyclone is likely to be the best way               to do so. This is because Psyclone provides:             <ul>              <li><span class="navLink">Easy incremental system creation</span></li>              <li><span class="navLink">Increased debugging support during development</span></li>              <li><span class="navLink">Flexible rewiring of data flow between                 components</span></li>              <li><span class="navLink">Central management of distributed system</span></li>              <li><span class="navLink">... and more</span></li>            </ul>            <p>If you need to connect multiple programs (that is, more than 2)               via the network you might want to look at one or more of the following               tutorials:</p>            <ol>              <li><span class="navLink"><a href="psycloneManual2.html#gettingstarted">How to start                 up Psyclone</a></span></li>              <li><span class="navLink">Running the provided external <a href="psycloneManual2.html#runningexternaljavaexamples">Java                 examples</a> / <a href="psycloneManual2.html#runningexternalcppexamples">C++ examples</a></span></li>              <li><span class="navLink"><a href="psycloneManual3.html#pub-sub">Creating a publish-subscribe                 system</a></span></li>            </ol>            <blockquote>               <p class="mediumSizeNonConspicuous">When running a time-dependent                 system across a network you may want to synchronize the clocks                 on the computers, otherwise the various <a href="psycloneManual.html#psy:post" class="navLink">post</a>                 and <a href="psycloneManual.html#psy:receive" class="navLink">receive</a>                 timestamps on <a href="http://www.mindmakers.org/openair/" class="navLink">OpenAIR                 messages</a> will not be comparable between computers. Synchronization                 can be done using the Network Time Protocol <a href="http://www.ntp.org/" class="navLink">NTP                 daemon</a>; it is compatible with virtually all platforms. </p>            </blockquote></td>        </tr>      </table>      <p>&nbsp;</p>      <table width="670" border=0 align="center" cellpadding=2 cellspacing=0 bgcolor="#FFFFFF" >        <tr valign=CENTER bgcolor="#F7F7F7" background="images/grey-bk.gif" bordercolor="#B9B9B9">           <td width="520" height="30" class="tutorialSubsectionHeading"><a name="connectingacrossfirewalls" id="connectingacrossfirewalls"></a>Connecting             programs across firewalls and routers</td>          <td width="118" align=RIGHT><b><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#B9B9B9"><a href="index.html" class="navLink"><b><font face="Verdana, Arial, Helvetica, sans-serif">Back             to Index</font></b></a></font></font></b></td>          <td align=RIGHT width="88">&nbsp;</td>        </tr>        <tr>           <td valign=TOP colspan="3" height="325"> <p><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif">Psyclone,               and its AIRPlugs, have built-in support that will automatically               detect and route network traffic in even the most complicated networks.               </font>             <p>To read about how to start up Psyclone, go <a href="psycloneManual2.html#gettingstarted" class="navLink">here</a>.             <p><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif">To               read about connecting programs via the network <a href="#connecting2programs" class="navLink">here</a>.</font>             <p><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif">               If you wish to hook up programs as modules all you need to do is               to make sure that they each can connect to Psyclone on its main               port, which is usually port 10000. If all the modules in the system               can connect to Psyclone on this port, your system will work, even               if Psyclone cannot open a new connection back to the module (because               of a firewall for example). </font>             <p><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif">               In all but the largest most complicated systems there will be no               noticeable delay in the networking when routing via firewalls and               routers. Only if you have multiple computers on each side of the               router or firewall will you notice a difference, as all communication               between modules on the inside and the outside of the system then               will be routed via the main Psyclone computer. However, in this               case you should consider asking your system administrator to allow               more liberal communication through your firewall.</font>             <blockquote>               <p class="mediumSizeNonConspicuous">When running a time-dependent                 system across a network you may want to synchronize the clocks                 on the computers, otherwise the various <a href="psycloneManual.html#psy:post" class="navLink">post</a>                 and <a href="psycloneManual.html#psy:receive" class="navLink">receive</a>                 timestamps on <a href="http://www.mindmakers.org/openair/" class="navLink">OpenAIR                 messages</a> will not be comparable between computers. Synchronization                 can be done using the Network Time Protocol <a href="http://www.ntp.org/" class="navLink">NTP                 daemon</a>; it is compatible with virtually all platforms. </p>            </blockquote></td>        </tr>      </table>      <p>&nbsp;</p>      <table width="670" border=0 align="center" cellpadding=2 cellspacing=0 bgcolor="#FFFFFF" >        <tr valign=CENTER bgcolor="#F7F7F7" background="images/grey-bk.gif" bordercolor="#B9B9B9">           <td width="520" height="30" class="tutorialSubsectionHeading"><a name="sendingbinarydatainmessages" id="sendingbinarydatainmessages"></a><a name="sendingbinarydata" id="sendingbinarydata"></a>Sending             binary data in a message</td>          <td width="118" align=RIGHT><b><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#B9B9B9"><a href="index.html" class="navLink"><b><font face="Verdana, Arial, Helvetica, sans-serif">Back             to Index</font></b></a></font></font></b></td>          <td align=RIGHT width="88">&nbsp;</td>        </tr>        <tr>           <td valign=TOP colspan="3" height="32"> <p><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif">Psyclone               has built-in support for binary content in messages. You would normally               use the object slot in a message for this content, just as you do               when sending other non-text information, such as dictionaries or               collections. If this object has binary content it will automatically               be attached as a binary attachment to the message when transmitted               across the network.</font>             <p><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif">               In both internal and external C++ and external Java modules you               can add raw binary data to a message using the DataSample object.               An example for C++ could be:</font>             <blockquote>               <p><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif">                 <span class="codeCPP">int len = 5322;<br>                char* data = new char[len];<br>                memset(data, 0, len);<br>                Message* msg = new Message(&quot;&quot;, &quot;&quot;, &quot;&quot;);<br>                DataSample* sample = new DataSample();<br>                sample-&gt;giveData(data, len);<br>                msg-&gt;setObject(sample);</span></font></p>            </blockquote>            <p><font color="#333333" face="Verdana, Arial, Helvetica, sans-serif">               In Java, you do almost the same:</font>             <blockquote>               <p class="codeJava">int len = 5322;<br>                byte[] data = new byte[len];<br>                for (int n=0; n&lt;len; n++)<br>                data[n] = 0;<br>                Message msg = new Message(&quot;&quot;, &quot;&quot;, &quot;&quot;);<br>                DataSample sample = new DataSample();<br>                sample.data = data;<br>                msg.object = sample;</p>            </blockquote>            <p> Now you can send your message as normal.             <p> You can create your own objects to carry binary information. In               Java you need to inherit from either the DataSample object or from               the BaseObject &#8211; please see the DataSample object to see what               you need. In C++ you need to obtain the version of the CoreLibary               source code which matches the version of the AIR Plug or the SDK               you are using and then implement a third party object. See the <a href="http://www.cmlabs.com/products/corelibrary" class="navLink">CoreLibrary               homepage</a> for more information on how to do this.</td>        </tr>      </table>      <p>&nbsp;</p>      <table width="670" border=0 align="center" cellpadding=2 cellspacing=0 bgcolor="#FFFFFF" >        <tr valign=CENTER bgcolor="#F7F7F7" background="images/grey-bk.gif" bordercolor="#999999">           <td width="462" height="30" class="tutorialSubsectionHeading"><a name="creatingpubsubsystem" id="creatingpubsubsystem"></a><a name="pub-sub" id="pub-sub"></a>Creating             a publish-subscribe system</td>          <td width="98" align=RIGHT><b><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#B9B9B9"><a href="index.html" class="navLink"><b><font face="Verdana, Arial, Helvetica, sans-serif">Back             to Index</font></b></a></font></font></b></td>          <td width="110" align=RIGHT class="navLink"><a href="psycloneManual.html#psy:pub-sub">About             pub-sub</a></td>        </tr>        <tr>           <td valign=TOP colspan="3" height="32"> <p>You can create a simple publish-subscribe               system in Psyclone by making two modules, one that posts a message               type and another that subscribes to that message. For this you use               an intermediate message handler called a <a href="psycloneManual.html#psy:whiteboard" class="navLink">whiteboard</a>.               If you are only planning on connecting two programs, and not to               expand your system beyond that, you need not read any further. To               see how to connect two programs over a network, go <a href="#connecting2programs" class="navLink">here</a>.             <p>In Psyclone simple pub-sub system can very quickly (and safely)               grow to a large pub-sub system: Once you have defined at least one               message type to be posted any module can subscribe to that message.               The best approach to take is to define all your modules in a <a href="psycloneManual.html#psy:psyspec" class="navLink">psySpec</a>.               For example, a module that posts a message of type <span class="keyConcept">A.B.C</span>               might look like this:             <p class="codeXML"> &lt;module name=&quot;<span class="dataValue">MyModule1</span>&quot;&gt;<br>              &nbsp;&nbsp;&nbsp;&lt;description&gt;<span class="dataValue">This               module bootstraps the dominos by setting their root context.</span>&lt;/description&gt;<br>              &nbsp;&nbsp;&nbsp;&lt;spec&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;context name=&quot;<span class="dataValue">Psyclone.System.Ready</span>&quot;&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;phase               name=&quot;<span class="dataValue">Look for System Created</span>&quot;&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;posts&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;post               to=&quot;<span class="dataValue">Whiteboard.1</span>&quot; type=&quot;<span class="dataValue">A.B.C</span>&quot;               /&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/posts&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/phase&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/context&gt;<br>              &nbsp;&nbsp;&nbsp;&lt;/spec&gt;<br>              &lt;/module&gt;             <p>According to this specification, this module will post message               of type <span class="keyConcept">A.B.C</span> when Psyclone is started               up and the system is created (Psyclone posts Psyclone.System.Ready               which starts our module). Any modules that want to subscribe to               the <span class="keyConcept">A.B.C</span> message type would be               specified like this:             <p class="codeXML">&lt;module name=&quot;<span class="dataValue">MyModule2</span>&quot;&gt;<br>              &nbsp;&nbsp;&nbsp;&lt;description&gt;<span class="dataValue">This               module bootstraps the dominos by setting their root context.</span>&lt;/description&gt;<br>              &nbsp;&nbsp;&nbsp;&lt;spec&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;context name=&quot;<span class="dataValue">Psyclone.System.Ready</span>&quot;&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;phase               name=&quot;<span class="dataValue">Look for alphabtic messages</span>&quot;&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;triggers               from=&quot;<span class="dataValue">Whiteboard.1</span>&quot;&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;trigger               type=&quot;<span class="dataValue">A.B.C</span>&quot;/&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/triggers&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;posts&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;post               to=&quot;<span class="dataValue">Whiteboard.1</span>&quot; type=&quot;<span class="dataValue">D.E.F</span>&quot;               /&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/posts&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/phase&gt;<br>              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/context&gt;<br>              &nbsp;&nbsp;&nbsp;&lt;/spec&gt;<br>              &lt;/module&gt;             <p>This module is triggered by <span class="keyConcept">MyModule1</span>'s               posting of <span class="keyConcept">A.B.C</span> and when it posts               messages it will post a message of type <span class="keyConcept">D.E.F</span>.             <p>Once defined as XML in the psySpec, you need to make sure that               the modules actually exist as executables. (One important thing               we are leaving out in the above example is that the two modules               have no <a href="psycloneManual.html#psy:crank"><span class="navLink">crank</span></a>,               or method to run when they get triggered.) To see how to run modules               that post and receive messages using cranks, follow the tutorial               on <a href="#connecting2modules"><span class="navLink">connecting               two modules via the network</span></a>, or look at the tutorial               on how to run the provided examples (<a href="psycloneManual2.html#creatinginternalcppmodules"><span class="navLink">internal               C++</span></a>, <a href="psycloneManual2.html#creatingexternalcppmodules" class="navLink">external               C++</a>, <a href="psycloneManual2.html#creatingexternaljavamodules" class="navLink">Java</a>).               More info on how to construct psySpecs is given <a href="psycloneManual2.html#usingpsyspec" class="navLink">here</a>.             <p>The big benefit about pub-sub systems is the relative ease with               which the &quot;wiring&quot; between modules can be changed: To               route a message A.B.C to MyModule4 instead of MyModule2 simply unregister               MyModule2 and register MyModule4 for the message type A.B.C. Registrations               can be specified up front in the psySpec or they can be transmitted               by the module directly to Psyclone when the module has started up               (and can be overwritten at any time). The registration tells Psyclone               which message types the module is interested in, among other things.               It can also tell Psyclone which contexts the module wants to be               active in and what kinds of messages the module will be posting.           </td>        </tr>      </table>      <p>&nbsp;</p>      <table width="670" border=0 align="center" cellpadding=2 cellspacing=0 bgcolor="#FFFFFF" >        <tr valign=CENTER bgcolor="#F7F7F7" background="images/grey-bk.gif" bordercolor="#999999">           <td width="399" height="30" class="tutorialSubsectionHeading"><a name="contextsandphases" id="contextsandphases"></a><a name="pub-sub" id="pub-sub"></a>Using             contexts &amp; phases <br>            in a hypothetical rocket launch system</td>          <td width="129" align=RIGHT><b><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#B9B9B9"><a href="index.html" class="navLink"><b><font face="Verdana, Arial, Helvetica, sans-serif">Back             to Index</font></b></a></font></font></b></td>          <td width="142" align=RIGHT class="navLink"><a href="psycloneManual.html#psy:contexts">About             contexts </a></td>        </tr>        <tr>           <td valign=TOP colspan="3" height="32"> <p>Contexts are used for managing               the global state of a system. Here we will take the example of starting               up and shutting down a system.             <p>The example we will use is that of a rocket. This hypothetical               rocket has three main modes that the system can be in: Launch, mid-flight               and re-entry. Then there are 30 software modules total that control               the rocket, but not all of them need to be involved in all three               modes. We will assume that 10 of them need to keep running at all               tiems, another 10 are only needed during launch and the final 10               are only needed during re-entry. To design this system we will use               the root-context Rocket.             <blockquote>               <p class="smallSizeNonConspicuous">A root context is the context                 at the beginning, or &quot;root&quot;, of the context list. For                 example, in the context tree <strong>First.Second.Third</strong>,                 the root context is the <strong>First</strong> context, because                 each context, going from left to right, is more specific than                 the one before. <strong>First.Second.Third</strong> is called                 a context <strong>tree</strong> because it represents a hierarchy                 where the second, third, etc. context listed can be replaced by                 other contexts, making the context hierarchy into a tree-like                 structure. Hierarchical contexts are explained in the <a href="psycloneManual.html#psy:contexts" class="navLink">manual</a>.</p>            </blockquote>            <p> There will be three branches on the root context to represent               the three stages of the rocket's lifespan which are Launch, Flight               and ReEntry. So we have the following possible context trees:             <blockquote>               <p> Rocket<br>                Rocket.Launch<br>                Rocket.Flight<br>                Rocket.ReEntry</p>            </blockquote>            <p> Since contexts are global states, and failure is one of those               system states that the whole system should know about, it would               also be good to represent this for the rocket:             <blockquote>               <p>Rocket.Fail </p>            </blockquote>            <p>However, the meaning of Rocket.Fail is rather unspecific (which               part of the Rocket has failed?), so it would be better to create               an additional fail branch for each of the different stages:             <blockquote>               <p> Rocket.Launch<br>                Rocket.Launch.Fail<br>                Rocket.Flight<br>                Rocket.Flight.Fail<br>                Rocket.ReEntry<br>                Rocket.ReEntry.Fail</p>            </blockquote>            <p> But who decides when each context should be posted? Some of the               software modules in the Rocket are specifically designed to monitor               the status of everything and these modules will in turn decide when               and if to post any of the contexts, including the Fail contexts.               For example, one module could be monitoring specifically whether               any part of the system fails during launch. If that happens the               module would post Rocket.Lauch.Fail.             <p>Now let's define a module whose job it is to manage these contexts.               It monitors the state of the system and makes sure that each context               is posted when appropriate. Let's call this module ContextPoster.               Initially, when the system is started up, Psyclone will automatically               post Psyclone.System.Ready, indicating that Psyclone is indeed started               and ready to run our system. This would mean that we can launch               the rocket. We use Psyclone.System.Ready as context and trigger               for the ContextPoster module.             <blockquote>               <p class="smallSizeNonConspicuous">Since contexts are posted like                 any other message, context postings can be used as triggers for                 any module. To post a context, use the message type <strong>Psyclone.Context:X</strong>,                 where the X is replaced with the name of the context you wish                 to post (make sure you don't forget the colon). This can be experimented                 with in the <a href="psycloneManual2.html#runningdominospsyspec"><span class="navLink">dominosPsySpec.xml</span></a>.               </p>            </blockquote>            <p>To make things simple, let's say that the rocket always launches               as soon as possible, so when ContextPoster is triggered it will               set the global context to Rocket.Launch by posting a context message               of type Rocket.Launch (Psyclone.Context:Rocket.Launch).             <p>We will make <strong>Rocket</strong> the context for the 10 modules               which should be active all the time. This means that even when Rocket.Launch,               Rocket.Flight and Rocket.ReEntry are posted, these modules will               still be <span class="keyConcept">in context</span>.             <blockquote>               <p class="smallSizeNonConspicuous">Child-contexts (branches) do                 not invalidate parent-contexts, they only make them more specific.                 For example, a biological system might have the context <strong>Alive.Awake</strong>,                 which specifies that the system is alive and awake. Should the                 system switch to being asleep the appropriate module would post                 <strong>Alive.Sleeping</strong>. One could then also have an intermediate                 stage, <strong>Alive.Sleepy</strong>, which helps manage the whole                 transition from the <strong>Awake</strong> state to the <strong>Sleeping</strong>                 state. During these context transitions the system is continuously                 alive &#8212; the root context is always valid.</p>            </blockquote>            <p>We will make Rocket.Launch the context for all modules that have               to be running during launch. ContextPoster will monitor the modules               and the rocket's own position in space, and when it's been launched               successfully it will post the context Rocket.Flight. When Rocket.Flight               is posted the context Rocket.Launch is no longer valid. Therefore,               all modules with Rocket.Launch as context will go out of context               -- they will no longer be able to receive triggers (and theoretically               therefore not take up any CPU).             <p>We will make Rocket.ReEntry the context for all modules that are               only supposed to be running during re-entry. These will be out of               context during flight and launch because the context Rocket.ReEntry               cannot be active while Rocket.Launch and Rocket.Flight are active.               Now, something could of course fail in the system at any time. We               will design ContextPoster such that it will post the context Rocket.Flight.Fail               if this happens during flight. We will further create a new module               that is designed for such conditions. Its context is Rocket.Flight.Fail.               This module, called FlightFailurePlanner, will determine when a               parachute should be deployed. Further, its job is to decide when               it's safe to initiate re-entry, at which point it would post Rocket.ReEntry.               This will activate all the modules needed for the re-entry condition,               i.e. all modules whose context is Rocket.ReEntry.</p></td>        </tr>      </table>      <p>&nbsp;</p>      <p>&nbsp;</p></td>  </tr></table><p>&nbsp;</p><table WIDTH="688" BORDER=0 align="center" CELLPADDING=2 CELLSPACING=0 bgcolor="#999999" >  <tr VALIGN=CENTER BGCOLOR="#F7F7F7" BACKGROUND="images/grey-bk.gif" bordercolor="#666666">     <td WIDTH="520" HEIGHT="18"><b><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#333333"><font size=-1><a name="troubleshooting"></a>Troubleshooting</font></font></font></b></td>    <td ALIGN=RIGHT WIDTH="80"></td>    <td ALIGN=RIGHT WIDTH="88"></td>  </tr>  <tr>     <td VALIGN=TOP COLSPAN="3" HEIGHT="184"><font face="Verdana, Arial, Helvetica, sans-serif"><font color="#FFFFFF" size=-1>-       Make sure you are in the correct directory for your operating system.</font></font>       <p><font color="#FFFFFF" face="Verdana, Arial, Helvetica, sans-serif"><font size=-1>-         Make sure you have included <a href="psycloneManual2.html#usingpsyclone" class="navLink">all         command line parameters needed</a>.</font></font>       <p><font color="#FFFFFF" face="Verdana, Arial, Helvetica, sans-serif"><font size=-1>-         Make sure your operating system knows the path to the directory where         the Psyclone executable is located. You may need to provide the whole         path on the command line.&nbsp;</font></font>       <p><font color="#FFFFFF" face="Verdana, Arial, Helvetica, sans-serif"><font size=-1>-         If you are having problems running the Java examples on your computer,         you may have to update your Java virtual machine. Alternatively, you can         try re-compiling the examples using the above instructions.</font></font>       <p><font color="#FFFFFF">- The nature of dynamically loaded libraries where they are loaded and         unloaded periodically means that static and global variables loose their         meaning. When creating internal crank functions do not use global or static         variables in your code. Furthermore, on some UNIX systems such as Linux         you will get errors when trying to load a library with static or global         variables, usually complaining about an undefined symbol: <span class="codeCPP">__dso_handle</span>.         If you see this, go through your code and remove all global and static         variables.       </font><p><font color="#FFFFFF" face="Verdana, Arial, Helvetica, sans-serif"><font size=-1><a href="mailto:support@cmlabs.com" class="navLink">Let         us know</a> if you experience persistent problems.</font></font></td>  </tr></table><p>&nbsp;</p><table WIDTH="688" BORDER=0 align="center" CELLPADDING=0 CELLSPACING=0 >  <tr>     <td ALIGN=LEFT VALIGN=BOTTOM><img SRC="images/simple-circle-line-1.gif"  align=BOTTOM></td>    <td>&nbsp;</td>  </tr>  <tr>     <td ALIGN=LEFT VALIGN=BOTTOM> <table WIDTH="688" HEIGHT="21" BORDER=0 align="center" CELLPADDING=0 CELLSPACING=0 >        <tr>           <td WIDTH="556" ALIGN=RIGHT VALIGN=TOP class="regularFootnoteLink"><a href="COPYRIGHT.txt">2006&copy;</a><a href="http://www.cmlabs.com">Communicative             Machines </a></td>          <td WIDTH="132" ALIGN=RIGHT VALIGN=TOP class="regularFootnoteLink"><a href="LICENSE.txt">License</a></td>        </tr>      </table></td>    <td>&nbsp;</td>  </tr></table><div align="center"><br>  &nbsp; </div></body></html>